<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue3.0 æºç è§£è¯»</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/slamdunk-the-vue3/onepunch.jpeg">
    <script src="https://hm.baidu.com/hm.js?4484bd6412288feacc311fd7f2054116"></script>
    <meta name="description" content="Vue3.0 æºç è§£è¯»">
    <link rel="preload" href="/slamdunk-the-vue3/assets/css/0.styles.8a77ab8b.css" as="style"><link rel="preload" href="/slamdunk-the-vue3/assets/js/app.01054a2c.js" as="script"><link rel="preload" href="/slamdunk-the-vue3/assets/js/2.53f3bd5a.js" as="script"><link rel="preload" href="/slamdunk-the-vue3/assets/js/16.1d75929f.js" as="script"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/10.3b123913.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/11.a5f7bb07.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/12.3ea9b157.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/13.ed39d1e0.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/14.f0377083.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/15.ec7a16fa.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/17.8d4038c4.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/18.ead9747b.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/19.7a6d3a31.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/20.7f0cbf2c.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/21.039e5e49.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/22.1d209a45.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/3.42ea3513.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/4.fca74266.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/5.2f76157e.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/6.0e4c4490.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/7.f11fe9a0.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/8.933cd8dd.js"><link rel="prefetch" href="/slamdunk-the-vue3/assets/js/9.d2c46ed2.js">
    <link rel="stylesheet" href="/slamdunk-the-vue3/assets/css/0.styles.8a77ab8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/slamdunk-the-vue3/" class="home-link router-link-active"><!----> <span class="site-name">Vue3.0 æºç è§£è¯»</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/slamdunk-the-vue3/main/" class="nav-link router-link-active">
  Vue 3.0 è§£è¯»
</a></div><div class="nav-item"><a href="/slamdunk-the-vue3/about.html" class="nav-link">
  å…³äºæˆ‘
</a></div><div class="nav-item"><a href="https://github.com/hkc452/slamdunk-the-vue3" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/slamdunk-the-vue3/main/" class="nav-link router-link-active">
  Vue 3.0 è§£è¯»
</a></div><div class="nav-item"><a href="/slamdunk-the-vue3/about.html" class="nav-link">
  å…³äºæˆ‘
</a></div><div class="nav-item"><a href="https://github.com/hkc452/slamdunk-the-vue3" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>å“åº”å¼ç³»ç»Ÿ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/slamdunk-the-vue3/main/vue/reactivity/effect.html" class="sidebar-link">effect</a></li><li><a href="/slamdunk-the-vue3/main/vue/reactivity/reactive.html" class="sidebar-link">reactive</a></li><li><a href="/slamdunk-the-vue3/main/vue/reactivity/baseHandlers.html" class="sidebar-link">baseHandlers</a></li><li><a href="/slamdunk-the-vue3/main/vue/reactivity/collectionHandlers.html" class="active sidebar-link">collectionHandlers</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/slamdunk-the-vue3/main/vue/reactivity/ref.html" class="sidebar-link">ref</a></li><li><a href="/slamdunk-the-vue3/main/vue/reactivity/computed.html" class="sidebar-link">computed</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¼–è¯‘æ¨¡å—</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/slamdunk-the-vue3/main/vue/compiler/compiler.html" class="sidebar-link">compiler</a></li><li><a href="/slamdunk-the-vue3/main/vue/compiler/parse.html" class="sidebar-link">parse</a></li><li><a href="/slamdunk-the-vue3/main/vue/compiler/transform.html" class="sidebar-link">transform(å‡†å¤‡å¼€å§‹æ–½å·¥ğŸš§)</a></li><li><a href="/slamdunk-the-vue3/main/vue/compiler/codegen.html" class="sidebar-link">codegen</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>collectionHandlers ä¸»è¦æ˜¯å¯¹ setã€mapã€weakSetã€weakMap å››ç§ç±»å‹çš„å¯¹è±¡è¿›è¡ŒåŠ«æŒã€‚
ä¸»è¦æœ‰ä¸‹é¢ä¸‰ç§ç±»å‹çš„ handlerï¼Œå½“ç„¶ç…§æ—§ï¼Œæˆ‘ä»¬æ‹¿å…¶ä¸­çš„ mutableCollectionHandlers è¿›è¡Œè®²è§£ã€‚å‰©ä½™ä¸¤ç§ç»“åˆç†è§£ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>export const mutableCollectionHandlers: ProxyHandler&lt;CollectionTypes&gt; = {
  get: createInstrumentationGetter(false, false)
}

export const shallowCollectionHandlers: ProxyHandler&lt;CollectionTypes&gt; = {
  get: createInstrumentationGetter(false, false)(false, true)
}

export const readonlyCollectionHandlers: ProxyHandler&lt;CollectionTypes&gt; = {
  get: createInstrumentationGetter(true, false)
}
</code></pre></div><p>mutableCollectionHandlers ä¸»è¦æ˜¯å¯¹ collection çš„æ–¹æ³•è¿›è¡ŒåŠ«æŒï¼Œæ‰€ä»¥ä¸»è¦æ˜¯å¯¹ get æ–¹æ³•è¿›è¡Œä»£ç†ï¼Œæ¥ä¸‹æ¥å¯¹ createInstrumentationGetter(false, false) è¿›è¡Œç ”ç©¶ã€‚</p> <p>instrumentations æ˜¯ä»£ç† get è®¿é—®çš„ handlerï¼Œå½“ç„¶å¦‚æœæˆ‘ä»¬è®¿é—®çš„ key æ˜¯ ReactiveFlagsï¼Œç›´æ¥è¿”å›å­˜å‚¨çš„å€¼ï¼Œå¦åˆ™å¦‚æœè®¿é—®çš„ key åœ¨ instrumentations ä¸Šï¼Œåœ¨ç”± instrumentations è¿›è¡Œå¤„ç†ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>function createInstrumentationGetter(isReadonly: boolean, shallow: boolean) {
  const instrumentations = shallow
    ? shallowInstrumentations
    : isReadonly
      ? readonlyInstrumentations
      : mutableInstrumentations

  return (
    target: CollectionTypes,
    key: string | symbol,
    receiver: CollectionTypes
  ) =&gt; {
    if (key === ReactiveFlags.isReactive) {
      return !isReadonly
    } else if (key === ReactiveFlags.isReadonly) {
      return isReadonly
    } else if (key === ReactiveFlags.raw) {
      return target
    }

    return Reflect.get(
      hasOwn(instrumentations, key) &amp;&amp; key in target
        ? instrumentations
        : target,
      key,
      receiver
    )
  }
}

</code></pre></div><p>æ¥ä¸‹æ¥çœ‹çœ‹ mutableInstrumentations ï¼Œå¯ä»¥çœ‹åˆ° mutableInstrumentations å¯¹å¸¸è§é›†åˆçš„å¢åˆ æ”¹æŸ¥ä»¥åŠ è¿­ä»£æ–¹æ³•è¿›è¡Œäº†ä»£ç†ï¼Œæˆ‘ä»¬å°±é¡ºç€ä¸Šé¢çš„ key æ€ä¹ˆè¿›è¡Œæ‹¦æˆªçš„ã€‚æ³¨æ„ this: MapTypes æ˜¯ ts ä¸Šå¯¹ this ç±»å‹è¿›è¡Œæ ‡æ³¨</p> <div class="language- extra-class"><pre class="language-text"><code>const mutableInstrumentations: Record&lt;string, Function&gt; = {
  get(this: MapTypes, key: unknown) {
    return get(this, key, toReactive)
  },
  get size() {
    return size((this as unknown) as IterableCollections)
  },
  has,
  add,
  set,
  delete: deleteEntry,
  clear,
  forEach: createForEach(false, false)
}
const iteratorMethods = ['keys', 'values', 'entries', Symbol.iterator]
iteratorMethods.forEach(method =&gt; {
  mutableInstrumentations[method as string] = createIterableMethod(
    method,
    false,
    false
  )
  readonlyInstrumentations[method as string] = createIterableMethod(
    method,
    true,
    false
  )
  shallowInstrumentations[method as string] = createIterableMethod(
    method,
    true,
    true
  )
})

</code></pre></div><h3 id="get-æ–¹æ³•"><a href="#get-æ–¹æ³•" class="header-anchor">#</a> get æ–¹æ³•</h3> <p>é¦–å…ˆè·å– target ï¼Œå¯¹ target è¿›è¡Œ toRawï¼Œ è¿™ä¸ªä¼šè¢« createInstrumentationGetter ä¸­çš„ proxy æ‹¦æˆªè¿”å›åŸå§‹çš„ targetï¼Œç„¶åå¯¹ key ä¹Ÿè¿›è¡Œä¸€æ¬¡ toRaw, å¦‚æœä¸¤è€…ä¸ä¸€æ ·ï¼Œè¯´æ˜ key ä¹Ÿæ˜¯ reative çš„ï¼Œ å¯¹ key  å’Œ rawkey éƒ½è¿›è¡Œ track ï¼Œç„¶åè°ƒç”¨ target åŸå‹ä¸Šé¢çš„ has æ–¹æ³•ï¼Œå¦‚æœ key ä¸º true ï¼Œè°ƒç”¨ get è·å–å€¼ï¼ŒåŒæ—¶å¯¹å€¼è¿›è¡Œ wrap ï¼Œå¯¹äº mutableInstrumentations è€Œè¨€ï¼Œå°±æ˜¯ toReactiveã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>function get(
  target: MapTypes,
  key: unknown,
  wrap: typeof toReactive | typeof toReadonly | typeof toShallow
) {
  target = toRaw(target)
  const rawKey = toRaw(key)
  if (key !== rawKey) {
    track(target, TrackOpTypes.GET, key)
  }
  track(target, TrackOpTypes.GET, rawKey)
  const { has, get } = getProto(target)
  if (has.call(target, key)) {
    return wrap(get.call(target, key))
  } else if (has.call(target, rawKey)) {
    return wrap(get.call(target, rawKey))
  }
}
</code></pre></div><h3 id="has-æ–¹æ³•"><a href="#has-æ–¹æ³•" class="header-anchor">#</a> has æ–¹æ³•</h3> <p>è·Ÿ get æ–¹æ³•å·®ä¸å¤šï¼Œä¹Ÿæ˜¯å¯¹ key å’Œ rawkey è¿›è¡Œ trackã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>function has(this: CollectionTypes, key: unknown): boolean {
  const target = toRaw(this)
  const rawKey = toRaw(key)
  if (key !== rawKey) {
    track(target, TrackOpTypes.HAS, key)
  }
  track(target, TrackOpTypes.HAS, rawKey)
  const has = getProto(target).has
  return has.call(target, key) || has.call(target, rawKey)
}
</code></pre></div><h3 id="size-å’Œ-add-æ–¹æ³•"><a href="#size-å’Œ-add-æ–¹æ³•" class="header-anchor">#</a> size å’Œ add æ–¹æ³•</h3> <p>size æœ€è¦æ˜¯è¿”å›é›†åˆçš„å¤§å°ï¼Œè°ƒç”¨åŸå‹ä¸Šçš„ size æ–¹æ³•ï¼ŒåŒæ—¶è§¦å‘ ITERATE ç±»å‹çš„ trackï¼Œè€Œ add æ–¹æ³•æ·»åŠ è¿›å»ä¹‹å‰è¦åˆ¤æ–­åŸæœ¬æ˜¯å¦å·²ç»å­˜åœ¨äº†ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¸ä¼šè§¦å‘ ADD ç±»å‹çš„ triggerã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>function size(target: IterableCollections) {
  target = toRaw(target)
  track(target, TrackOpTypes.ITERATE, ITERATE_KEY)
  return Reflect.get(getProto(target), 'size', target)
}

function add(this: SetTypes, value: unknown) {
  value = toRaw(value)
  const target = toRaw(this)
  const proto = getProto(target)
  const hadKey = proto.has.call(target, value)
  const result = proto.add.call(target, value)
  if (!hadKey) {
    trigger(target, TriggerOpTypes.ADD, value, value)
  }
  return result
}
</code></pre></div><h3 id="set-æ–¹æ³•"><a href="#set-æ–¹æ³•" class="header-anchor">#</a> set æ–¹æ³•</h3> <p>set æ–¹æ³•æ˜¯é’ˆå¯¹ map ç±»å‹çš„ï¼Œä» this çš„ç±»å‹æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥äº†ï¼Œ åŒæ ·è¿™é‡Œæˆ‘ä»¬ä¹Ÿä¼šå¯¹ key åšä¸¤ä¸ªæ ¡éªŒï¼Œç¬¬ä¸€ï¼Œæ˜¯çœ‹çœ‹ç°åœ¨ map ä¸Šé¢æœ‰æ²¡æœ‰å­˜åœ¨åŒåçš„ keyï¼Œæ¥å†³å®šæ˜¯è§¦å‘ SET è¿˜æ˜¯ ADD çš„ triggerï¼Œ ç¬¬äºŒï¼Œå¯¹äºå¼€å‘ç¯å¢ƒï¼Œä¼šè¿›è¡Œ checkIdentityKeys æ£€æŸ¥</p> <div class="language- extra-class"><pre class="language-text"><code>function set(this: MapTypes, key: unknown, value: unknown) {
  value = toRaw(value)
  const target = toRaw(this)
  const { has, get, set } = getProto(target)

  let hadKey = has.call(target, key)
  if (!hadKey) {
    key = toRaw(key)
    hadKey = has.call(target, key)
  } else if (__DEV__) {
    checkIdentityKeys(target, has, key)
  }

  const oldValue = get.call(target, key)
  const result = set.call(target, key, value)
  if (!hadKey) {
    trigger(target, TriggerOpTypes.ADD, key, value)
  } else if (hasChanged(value, oldValue)) {
    trigger(target, TriggerOpTypes.SET, key, value, oldValue)
  }
  return result
}
</code></pre></div><p>checkIdentityKeys å°±æ˜¯ä¸ºäº†æ£€æŸ¥ç›®æ ‡å¯¹è±¡ä¸Šé¢ï¼Œæ˜¯ä¸æ˜¯åŒæ—¶å­˜åœ¨ rawkey å’Œ keyï¼Œå› ä¸ºè¿™æ ·å¯èƒ½ä¼šæ•°æ®ä¸ä¸€è‡´ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>function checkIdentityKeys(
  target: CollectionTypes,
  has: (key: unknown) =&gt; boolean,
  key: unknown
) {
  const rawKey = toRaw(key)
  if (rawKey !== key &amp;&amp; has.call(target, rawKey)) {
    const type = toRawType(target)
    console.warn(
      `Reactive ${type} contains both the raw and reactive ` +
        `versions of the same object${type === `Map` ? `as keys` : ``}, ` +
        `which can lead to inconsistencies. ` +
        `Avoid differentiating between the raw and reactive versions ` +
        `of an object and only use the reactive version if possible.`
    )
  }
}
</code></pre></div><h3 id="deleteentry-å’Œ-clear-æ–¹æ³•"><a href="#deleteentry-å’Œ-clear-æ–¹æ³•" class="header-anchor">#</a> deleteEntry å’Œ clear æ–¹æ³•</h3> <p>deleteEntry ä¸»è¦æ˜¯ä¸ºäº†è§¦å‘ DELETE trigger ï¼Œæµç¨‹è·Ÿä¸Šé¢ set æ–¹æ³•å·®ä¸å¤šï¼Œè€Œ clear  æ–¹æ³•ä¸»è¦æ˜¯è§¦å‘ CLEAR trackï¼Œä½†æ˜¯é‡Œé¢åšäº†ä¸€ä¸ªé˜²å¾¡æ€§çš„æ“ä½œï¼Œå°±æ˜¯å¦‚æœé›†åˆçš„é•¿åº¦å·²ç»ä¸º0ï¼Œåˆ™è°ƒç”¨ clear æ–¹æ³•ä¸ä¼šè§¦å‘ triggerã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>function deleteEntry(this: CollectionTypes, key: unknown) {
  const target = toRaw(this)
  const { has, get, delete: del } = getProto(target)
  let hadKey = has.call(target, key)
  if (!hadKey) {
    key = toRaw(key)
    hadKey = has.call(target, key)
  } else if (__DEV__) {
    checkIdentityKeys(target, has, key)
  }

  const oldValue = get ? get.call(target, key) : undefined
  // forward the operation before queueing reactions
  const result = del.call(target, key)
  if (hadKey) {
    trigger(target, TriggerOpTypes.DELETE, key, undefined, oldValue)
  }
  return result
}

function clear(this: IterableCollections) {
  const target = toRaw(this)
  const hadItems = target.size !== 0
  const oldTarget = __DEV__
    ? target instanceof Map
      ? new Map(target)
      : new Set(target)
    : undefined
  // forward the operation before queueing reactions
  const result = getProto(target).clear.call(target)
  if (hadItems) {
    trigger(target, TriggerOpTypes.CLEAR, undefined, undefined, oldTarget)
  }
  return result
}
</code></pre></div><h3 id="foreach-æ–¹æ³•"><a href="#foreach-æ–¹æ³•" class="header-anchor">#</a> forEach æ–¹æ³•</h3> <p>åœ¨è°ƒç”¨ froEach æ–¹æ³•çš„æ—¶å€™ä¼šè§¦å‘ ITERATE ç±»å‹çš„ trackï¼Œéœ€è¦æ³¨æ„ Size æ–¹æ³•ä¹Ÿä¼šåŒæ ·ç±»å‹çš„ trackï¼Œæ¯•ç«Ÿé›†åˆæ•´ä½“çš„å˜åŒ–ä¼šå¯¼è‡´æ•´ä¸ªä¸¤ä¸ªæ–¹æ³•çš„è¾“å‡ºä¸ä¸€æ ·ã€‚é¡ºå¸¦æä¸€å¥ï¼Œè¿˜è®°å¾—æˆ‘ä»¬çš„ effect æ—¶å€™çš„ trigger å—ï¼Œå¯¹äº SET | ADD | DELETE ç­‰ç±»ä¼¼çš„æ“ä½œï¼Œå› ä¸ºä¼šå¯¼è‡´é›†åˆå€¼å¾—å˜åŒ–ï¼Œæ‰€ä»¥ä¹Ÿä¼šè§¦å‘ ITERATE_KEY æˆ–åˆ™ MAP_KEY_ITERATE_KEY çš„ effect é‡æ–°æ”¶é›†ä¾èµ–ã€‚</p> <p>åœ¨è°ƒç”¨åŸå‹ä¸Šçš„ forEach è¿›è¡Œå¾ªç¯çš„æ—¶å€™ï¼Œä¼šå¯¹ key å’Œ value éƒ½è¿›è¡Œä¸€å±‚ wrapï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œå°±æ˜¯ reactiveã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>function createForEach(isReadonly: boolean, shallow: boolean) {
  return function forEach(
    this: IterableCollections,
    callback: Function,
    thisArg?: unknown
  ) {
    const observed = this
    const target = toRaw(observed)
    const wrap = isReadonly ? toReadonly : shallow ? toShallow : toReactive
    !isReadonly &amp;&amp; track(target, TrackOpTypes.ITERATE, ITERATE_KEY)
    // important: create sure the callback is
    // 1. invoked with the reactive map as `this` and 3rd arg
    // 2. the value received should be a corresponding reactive/readonly.
    function wrappedCallback(value: unknown, key: unknown) {
      return callback.call(thisArg, wrap(value), wrap(key), observed)
    }
    return getProto(target).forEach.call(target, wrappedCallback)
  }
}

</code></pre></div><h3 id="createiterablemethod-æ–¹æ³•"><a href="#createiterablemethod-æ–¹æ³•" class="header-anchor">#</a> createIterableMethod æ–¹æ³•</h3> <p>ä¸»è¦æ˜¯å¯¹é›†åˆä¸­çš„è¿­ä»£è¿›è¡Œä»£ç†ï¼Œ<code>['keys', 'values', 'entries', Symbol.iterator]</code> ä¸»è¦æ˜¯è¿™å››ä¸ªæ–¹æ³•ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>const iteratorMethods = ['keys', 'values', 'entries', Symbol.iterator]
iteratorMethods.forEach(method =&gt; {
  mutableInstrumentations[method as string] = createIterableMethod(
    method,
    false,
    false
  )
  readonlyInstrumentations[method as string] = createIterableMethod(
    method,
    true,
    false
  )
  shallowInstrumentations[method as string] = createIterableMethod(
    method,
    true,
    true
  )
})
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šè§¦å‘ TrackOpTypes.ITERATE ç±»å‹çš„ trackï¼ŒåŒæ ·ä¹Ÿä¼šåœ¨éå†çš„æ—¶å€™å¯¹å€¼è¿›è¡Œ wrapï¼Œéœ€è¦ä¸»è¦çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ iterator protocol è¿›è¡Œä¸€ä¸ª polyfillï¼Œ æ‰€ä»¥éœ€è¦å®ç°åŒæ ·çš„æ¥å£æ–¹ä¾¿å¤–éƒ¨è¿›è¡Œè¿­ä»£ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>function createIterableMethod(
  method: string | symbol,
  isReadonly: boolean,
  shallow: boolean
) {
  return function(this: IterableCollections, ...args: unknown[]) {
    const target = toRaw(this)
    const isMap = target instanceof Map
    const isPair = method === 'entries' || (method === Symbol.iterator &amp;&amp; isMap)
    const isKeyOnly = method === 'keys' &amp;&amp; isMap
    const innerIterator = getProto(target)[method].apply(target, args)
    const wrap = isReadonly ? toReadonly : shallow ? toShallow : toReactive
    !isReadonly &amp;&amp;
      track(
        target,
        TrackOpTypes.ITERATE,
        isKeyOnly ? MAP_KEY_ITERATE_KEY : ITERATE_KEY
      )
    // return a wrapped iterator which returns observed versions of the
    // values emitted from the real iterator
    return {
      // iterator protocol
      next() {
        const { value, done } = innerIterator.next()
        return done
          ? { value, done }
          : {
              value: isPair ? [wrap(value[0]), wrap(value[1])] : wrap(value),
              done
            }
      },
      // iterable protocol
      [Symbol.iterator]() {
        return this
      }
    }
  }
}
</code></pre></div><p>æ€»çš„æ¥è¯´å¯¹é›†åˆçš„ä»£ç†ï¼Œå°±æ˜¯å¯¹é›†åˆæ–¹æ³•çš„ä»£ç†ï¼Œåœ¨é›†åˆæ–¹æ³•çš„æ‰§è¡Œçš„æ—¶å€™ï¼Œè¿›è¡Œä¸åŒç±»å‹çš„ key çš„ track æˆ–è€… triggerã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/slamdunk-the-vue3/main/vue/reactivity/baseHandlers.html" class="prev">
        baseHandlers
      </a></span> <span class="next"><a href="/slamdunk-the-vue3/main/vue/reactivity/ref.html">
        ref
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/slamdunk-the-vue3/assets/js/app.01054a2c.js" defer></script><script src="/slamdunk-the-vue3/assets/js/2.53f3bd5a.js" defer></script><script src="/slamdunk-the-vue3/assets/js/16.1d75929f.js" defer></script>
  </body>
</html>
